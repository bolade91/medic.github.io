'use strict';

(function() {

	class MainController {

		constructor($scope, localStorageService, modal) {

			this.events = localStorageService.get('data') != null ? localStorageService.get('data') : [];
			this.id = localStorageService.get('id') != null ? localStorageService.get('id') : 0;

			this.calname = localStorageService.get('calname') != null ? localStorageService.get('calname') : "";
			this.by = localStorageService.get('by') != null ? localStorageService.get('by') : "";


			localStorageService.set('data', this.events);
			localStorageService.set('id', this.id);

			localStorageService.set('calname', this.calname);
			localStorageService.set('by', this.by);
			
      $scope.name = this.calname;
      $scope.by = this.by;

      $scope.createLink = function() {
      	if ($scope.name && $scope.by) {
      		localStorageService.set('calname', $scope.name);
      		localStorageService.set('by', $scope.by);
      	}
      };

      $scope.clearAll = function() {
      	var modalOptions = {
      		templateUrl: 'app/modal/modal.html',
      		controller: 'dialogController',
      		controllerAs: 'dialogCtrl',
      		scope: $scope
      	}
      	modal.open(modalOptions);
      }

      $scope.createPDF = function() {

      	if ($scope.name && $scope.by) {
      		localStorageService.set('calname', $scope.name);
      		localStorageService.set('by', $scope.by);
      	}

      	
      	var calDate = moment().format("MMMM D, YYYY")
      	var calName = JSON.parse(localStorage.getItem('plannerx.calname'));
      	var calBy = JSON.parse(localStorage.getItem('plannerx.by'));
				/// TM start
				function formatAMPM(date) {
					var hours = date.getHours();
					var minutes = date.getMinutes();
					var ampm = hours >= 12 ? 'PM' : 'AM';
					hours = hours % 12;
					hours = hours ? hours : 12; // the hour '0' should be '12'
					minutes = minutes < 10 ? '0' + minutes : minutes;
					var strTime = hours + ':' + minutes + ' ' + ampm;
					return strTime;
				}



				var data = JSON.parse(localStorage.getItem('plannerx.data'));

				var sortDataByTime = function(lhs, rhs) {
					return new Date(lhs['start']) - new Date(rhs['start']);
				}
				data.sort(sortDataByTime);

				// console.log(data);
				var byday = {};
				var d = new Date();
				var weekday = new Array(7);
				weekday[0] = "SUNDAY";
				weekday[1] = "MONDAY";
				weekday[2] = "TUESDAY";
				weekday[3] = "WEDNESDAY";
				weekday[4] = "THURSDAY";
				weekday[5] = "FRIDAY";
				weekday[6] = "SATURDAY";



				function groupday(value, index, array) {
					d = new Date(value['start']);
					byday[weekday[d.getDay()]] = byday[weekday[d.getDay()]] || [];
					byday[weekday[d.getDay()]].push(value);
				}
				data.map(groupday);
				var body = [];
				var docDefinition = {
					pageSize: 'LETTER',
					pageMargins: [40, 130, 40, 60],
					header: {
						columns: [{
							stack: [{
								text: '' + calDate,
								alignment: 'left',
								margin: [40, 30, 0, 0],
								style: 'pageHeader'
							}, {
								text: 'Daily / Hourly View',
								margin: [40, 0, 0, 0],
								fontSize: 10
							}, {
								text: calName,
								margin: [40, 15, 0, 0],
								fontSize: 18,
								bold: true
							}, {
								text: 'Created by: ' + calBy,
								margin: [42, 5, 0, 0],
								fontSize: 12
							}]
						}, {
							stack: [{
								image: 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4RDQRXhpZgAATU0AKgAAAAgABAE7AAIAAAADdG0AAIdpAAQAAAABAAAISpydAAEAAAAGAAAQwuocAAcAAAgMAAAAPgAAAAAc6gAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFkAMAAgAAABQAABCYkAQAAgAAABQAABCskpEAAgAAAAMxNQAAkpIAAgAAAAMxNQAA6hwABwAACAwAAAiMAAAAABzqAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAxNjowOToyNCAyMzoyMToxMQAyMDE2OjA5OjI0IDIzOjIxOjExAAAAdABtAAAA/+ELFWh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4NCjx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iPjxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+PHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9InV1aWQ6ZmFmNWJkZDUtYmEzZC0xMWRhLWFkMzEtZDMzZDc1MTgyZjFiIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iLz48cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0idXVpZDpmYWY1YmRkNS1iYTNkLTExZGEtYWQzMS1kMzNkNzUxODJmMWIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyI+PHhtcDpDcmVhdGVEYXRlPjIwMTYtMDktMjRUMjM6MjE6MTEuMTUwPC94bXA6Q3JlYXRlRGF0ZT48L3JkZjpEZXNjcmlwdGlvbj48cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0idXVpZDpmYWY1YmRkNS1iYTNkLTExZGEtYWQzMS1kMzNkNzUxODJmMWIiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyI+PGRjOmNyZWF0b3I+PHJkZjpTZXEgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj48cmRmOmxpPnRtPC9yZGY6bGk+PC9yZGY6U2VxPg0KCQkJPC9kYzpjcmVhdG9yPjwvcmRmOkRlc2NyaXB0aW9uPjwvcmRmOlJERj48L3g6eG1wbWV0YT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgPD94cGFja2V0IGVuZD0ndyc/Pv/bAEMABwUFBgUEBwYFBggHBwgKEQsKCQkKFQ8QDBEYFRoZ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'
							}],
							alignment: 'right',
							fontSize: 12,
							margin: [0, 30, 40, 0]
						}]
					},
					footer: function(page, pages) {
						return {
							text: [
							'PAGE ', {
								text: page.toString(),
								italics: false
							},
							' of ', {
								text: pages.toString(),
								italics: false
							}
							],
							alignment: 'center',
							fontSize: 9,
							margin: [0, 20]
						};
					},
					styles: {
						pageHeader: {
							fontSize: 12,
							bold: true
						},
						header: {
							fontSize: 16,
							bold: true,
							margin: [0, 20, 10, 10]
						},
						subheader: {
							fontSize: 11,
							bold: false,
							lineHeight: 1.25,
						}
					},
					defaultStyle: {
						// alignment: 'justify'
					}
				}
				docDefinition.content = [];
				for (var obj in byday) {
					var header = {
						text: obj,
						style: 'header',
						layout: 'headerLineOnly'
					}
					var style = {
						style: 'subheader',
						table: {
							widths: [100, 100, 140, 180],
						},
						layout: 'headerLineOnly'
					}
					for (var item in byday[obj]) {
						// console.log(byday[obj][item])
						// console.log(byday[obj][item].option)
						var myOption = '';
						if (byday[obj][item].option !== undefined) {
							var myOption = byday[obj][item].option;
						};
						console.log(myOption);
						body.push(
							[formatAMPM(new Date(byday[obj][item].start)) + " - " +
							formatAMPM(new Date(byday[obj][item].end)), byday[obj][item].title, myOption, byday[obj][item].description
							]
							)
					}
					style.table.body = body;
					docDefinition.content.push([header, style])
					body = [];
				}
				// TM ends
				pdfMake.createPdf(docDefinition).download('plannerx.pdf');
			}
		}
	}

	angular.module('plannerx')
	.controller('MainController', MainController);
})();